<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>みじかい文をつくろう</title>
  <style>
    :root{
      --bg1:#eef2ff; --bg2:#f3e8ff; --card:#ffffffcc;
      --ink:#111827; --sub:#4b5563; --border:#d1d5db;
      --primary:#4f46e5; --ok:#16a34a;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; min-height:100vh; padding:16px;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",
        "Hiragino Kaku Gothic ProN","ヒラギノ角ゴ ProN","Yu Gothic","Meiryo",sans-serif;
      color:var(--ink);
      display:flex; justify-content:center; align-items:flex-start;
    }
    .wrap{ width:100%; max-width:860px; }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px;
      box-shadow:0 8px 24px rgba(0,0,0,.08);
      backdrop-filter: blur(8px);
    }
    h1{ font-size:20px; margin:0 0 12px; text-align:center; }

    .prompt{
      padding:12px;
      border-radius:14px;
      background:#fff;
      border:1px solid var(--border);
      font-size:18px;
      line-height:1.7;
    }
    textarea{
      width:100%;
      min-height:140px;
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      resize:vertical;
      line-height:1.6;
      font-size:18px;
    }
    .btns{ margin-top:12px; }
    button{
      border:none;
      background:var(--primary);
      color:#fff;
      padding:12px 16px;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      font-size:16px;
      box-shadow:0 6px 14px rgba(79,70,229,0.25);
    }

    .result{
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      font-size:18px;
      text-align:center;
      display:none;
    }
    .ok{ color:var(--ok); font-weight:900; }

    /* ===== くす玉（修正版） ===== */
    .kusudama{
      position:relative;
      width:200px;
      height:160px;
      margin:14px auto 0;
      display:none;
    }
    .string{
      position:absolute;
      top:0; left:50%;
      width:4px; height:30px;
      background:#666;
      transform:translateX(-50%);
    }
    .ball{
      position:absolute;
      top:30px; left:50%;
      width:200px; height:120px;
      transform:translateX(-50%);
      overflow:visible;
    }
    .half{
      position:absolute;
      top:0;
      width:100px; height:120px;
      background:#fff;
      border:2px solid #c7d2fe;
      border-bottom-left-radius:100px;
      border-bottom-right-radius:100px;
      transition:transform .4s ease;
    }
    .half.left{
      left:0;
      transform-origin:right top;
      background:#eef2ff;
    }
    .half.right{
      right:0;
      transform-origin:left top;
      background:#fce7f3;
    }
    .open .half.left{
      transform:rotate(-45deg);
    }
    .open .half.right{
      transform:rotate(45deg);
    }
    .label{
      position:absolute;
      top:40px; left:50%;
      transform:translateX(-50%);
      font-weight:900;
      background:#fff;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      z-index:2;
      white-space:nowrap;
    }

    /* 紙吹雪 */
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:999;
    }
    .confetti span{
      position:absolute;
      top:-10px;
      width:8px; height:14px;
      animation:fall 1s linear forwards;
      opacity:.9;
    }
    @keyframes fall{
      to{ transform:translateY(100vh) rotate(360deg); opacity:1; }
    }

    ruby rt{ font-size:.6em; color:var(--sub); }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>みじかい文をつくろう</h1>

    <div class="prompt">
      「〇〇」という
      <ruby>言葉<rt>ことば</rt></ruby>を
      <ruby>使<rt>つか</rt></ruby>って、
      <ruby>短<rt>みじか</rt></ruby>い
      <ruby>文<rt>ぶん</rt></ruby>を
      <ruby>作<rt>つく</rt></ruby>りましょう。
    </div>

    <textarea id="answer" placeholder="ここに文を入力"></textarea>

    <div class="btns">
      <button id="btnDone">できた！</button>
    </div>

    <div class="result" id="resultBox"></div>

    <div class="kusudama" id="kusudama">
      <div class="string"></div>
      <div class="ball">
        <div class="label" id="kLabel">よくできました！</div>
        <div class="half left"></div>
        <div class="half right"></div>
      </div>
    </div>
  </div>
</div>

<div class="confetti" id="confetti"></div>

<script>
  const btnDone = document.getElementById("btnDone");
  const answer = document.getElementById("answer");
  const result = document.getElementById("resultBox");
  const kusu = document.getElementById("kusudama");
  const label = document.getElementById("kLabel");
  const confetti = document.getElementById("confetti");

  function normalize(s){
    return (s||"").replace(/\s+/g,"").trim();
  }

  function popConfetti(){
    confetti.innerHTML = "";
    for(let i=0;i<24;i++){
      const c = document.createElement("span");
      c.style.left = Math.random()*100+"%";
      c.style.background = `hsl(${Math.random()*360},80%,60%)`;
      c.style.animationDelay = (Math.random()*200)+"ms";
      confetti.appendChild(c);
    }
    setTimeout(()=>confetti.innerHTML="",1200);
  }

  btnDone.addEventListener("click", ()=>{
    kusu.style.display="none";
    kusu.classList.remove("open");
    result.style.display="none";

    if(!normalize(answer.value)) return;

    result.style.display="block";
    result.innerHTML = `<div class="ok">よくできました！</div>`;

    kusu.style.display="block";
    setTimeout(()=>kusu.classList.add("open"),50);
    popConfetti();
  });

  answer.addEventListener("input", ()=>{
    kusu.style.display="none";
    kusu.classList.remove("open");
    result.style.display="none";
  });
</script>
</body>
</html>
