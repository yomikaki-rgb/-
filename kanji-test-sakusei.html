/* ===============================
   ★セット削除
=============================== */
if(btnDeleteSet){
  btnDeleteSet.addEventListener("click", ()=>{
    if(!session.createUnlocked){
      alert("先生用画面で解除してください。");
      return;
    }

    if(sets.length <= 1){
      alert("最後の1セットは削除できません。");
      return;
    }

    const sid = settings.currentSetId;
    const target = sets.find(s => s.id === sid);
    if(!target) return;

    if(!confirm(`「${target.name}」を削除します。\nこのセットの問題・解答・履歴はすべて消えます。`)){
      return;
    }

    // setsから削除
    sets = sets.filter(s => s.id !== sid);
    saveSets();

    // 問題・解答削除
    localStorage.removeItem(KQ_PREFIX + sid);
    localStorage.removeItem(KA_PREFIX + sid);

    // 履歴削除
    attemptsIndex = loadJSON(KATTEMPTS_INDEX, [])
      .filter(a => a.setId !== sid);
    saveAttemptsIndex();

    // 新しいカレントセットを先頭に
    settings.currentSetId = sets[0].id;
    saveSettings();

    rebuildSetSelectOptions();
    switchSet(settings.currentSetId);

    alert("セットを削除しました。");
  });
}
