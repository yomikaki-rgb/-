<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>語いクイズ</title>
  <style>

    :root {
      --bg1:#eef2ff;
      --bg2:#f3e8ff;
      --card:#ffffffcc;
      --ink:#111827;
      --ink-sub:#4b5563;
      --primary:#4f46e5;
      --primary-soft:#e0e7ff;
      --correct:#16a34a;
      --wrong:#dc2626;
      --border:#d1d5db;
    }
    * {
      box-sizing:border-box;
      -webkit-tap-highlight-color:transparent;
    }
    body {
      margin:0;
      min-height:100vh;
      padding:16px;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",
        "Hiragino Kaku Gothic ProN","ヒラギノ角ゴ ProN","Yu Gothic","メイリオ",sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .app {
      width:100%;
      max-width:700px;
      background:var(--card);
      border-radius:18px;
      padding:20px 18px 18px;
      box-shadow:0 20px 40px rgba(15,23,42,0.25);
    }
    .app-title {
      font-size:1.4rem;
      font-weight:700;
      text-align:center;
      margin-bottom:8px;
      color:var(--ink);
    }
    .status-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:0.9rem;
      color:var(--ink-sub);
      margin-bottom:10px;
    }
    .progress-bar {
      width:100%;
      height:8px;
      background:#e5e7eb;
      border-radius:999px;
      overflow:hidden;
      margin-bottom:16px;
    }
    .progress-fill {
      height:100%;
      width:0%;
      background:var(--primary);
      transition:width 0.25s ease-out;
    }
    .card {
      background:white;
      border-radius:16px;
      border:1px solid var(--border);
      padding:16px;
    }
    .question-text {
      font-size:1.15rem;
      line-height:1.6;
      margin-bottom:14px;
      color:var(--ink);
    }
    .hint {
      font-size:0.85rem;
      color:var(--ink-sub);
      margin-bottom:10px;
    }
    .choices {
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom:10px;
    }
    .choice-btn {
      border:1px solid var(--border);
      border-radius:999px;
      padding:8px 14px;
      font-size:1rem;
      text-align:left;
      background:#f9fafb;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      transition:transform 0.05s ease, box-shadow 0.05s ease, background 0.15s;
    }
    .choice-btn span.label { flex:1; }
    .choice-btn span.mark {
      font-size:0.8rem;
      opacity:0.7;
    }
    .choice-btn:active {
      transform:scale(0.98);
      box-shadow:0 2px 4px rgba(15,23,42,0.12);
    }
    .choice-btn.disabled {
      cursor:default;
      opacity:0.85;
    }
    .choice-btn.correct {
      border-color:var(--correct);
      background:#ecfdf3;
      color:var(--correct);
      font-weight:600;
    }
    .choice-btn.wrong {
      border-color:var(--wrong);
      background:#fef2f2;
      color:var(--wrong);
      font-weight:600;
    }
    .feedback {
      min-height:1.6em;
      font-size:0.95rem;
      margin-top:4px;
    }
    .feedback.correct { color:var(--correct); }
    .feedback.wrong { color:var(--wrong); }

    .nav-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:12px;
      gap:8px;
    }
    .score-text {
      font-size:0.9rem;
      color:var(--ink-sub);
    }
    .next-btn {
      border:none;
      border-radius:999px;
      background:var(--primary);
      color:white;
      font-size:0.95rem;
      font-weight:600;
      padding:8px 18px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      box-shadow:0 6px 14px rgba(79,70,229,0.35);
      transition:transform 0.05s ease, box-shadow 0.05s ease, opacity 0.15s;
      white-space:nowrap;
    }
    .next-btn:active {
      transform:translateY(1px);
      box-shadow:0 3px 8px rgba(79,70,229,0.4);
    }
    .next-btn.disabled {
      opacity:0.4;
      cursor:default;
      box-shadow:none;
      transform:none;
    }

    .roulette {
      margin-top:14px;
      text-align:center;
    }
    .roulette-label {
      font-size:0.9rem;
      color:var(--ink-sub);
      margin-bottom:4px;
    }
    .roulette-wheel {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:72px;
      height:72px;
      border-radius:999px;
      border:2px solid var(--primary);
      font-size:1.4rem;
      font-weight:700;
      background:#ffffff;
      box-shadow:0 6px 14px rgba(79,70,229,0.25);
      cursor:pointer;
    }
    .roulette-wheel.disabled {
      opacity:0.4;
      cursor:default;
    }

    .card-container {
      margin-top:8px;
      display:none;
      justify-content:center;
      gap:10px;
    }
    .card-option {
      width:60px;
      height:80px;
      border-radius:10px;
      border:2px solid var(--primary);
      background:linear-gradient(135deg,#e5e7eb,#d1d5db);
      box-shadow:0 4px 8px rgba(15,23,42,0.15);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.3rem;
      font-weight:700;
      cursor:pointer;
      transition:transform 0.1s ease, box-shadow 0.1s ease, background 0.15s, border-color 0.15s;
    }
    .card-option:active {
      transform:translateY(1px);
      box-shadow:0 2px 4px rgba(15,23,42,0.2);
    }
    .card-option.disabled {
      opacity:0.6;
      cursor:default;
      box-shadow:none;
    }
    .card-option.selected {
      background:#ffffff;
      border-color:var(--correct);
    }

    .result {
      text-align:center;
      margin-top:8px;
      font-size:1rem;
    }
    .restart-btn {
      margin-top:10px;
      border-radius:999px;
      border:1px solid var(--primary);
      background:white;
      color:var(--primary);
      font-weight:600;
      font-size:0.95rem;
      padding:8px 16px;
      cursor:pointer;
    }

    ruby rt {
      font-size:0.6em;
    }

    @media (max-width:480px) {
      .app { padding:16px 12px 14px; }
      .question-text { font-size:1.05rem; }
      .choice-btn { padding:8px 10px; font-size:0.95rem; }
      .roulette-wheel { width:64px; height:64px; font-size:1.2rem; }
      .card-option {
        width:52px;
        height:72px;
        font-size:1.1rem;
      }
    }
  

    /* ====== Online side panel (added) ====== */
    .shell{
      width:100%;
      max-width:980px;
      display:flex;
      gap:14px;
      align-items:stretch;
      justify-content:center;
    }
    .shell-main{ flex:1 1 auto; min-width:0; }
    .side{
      width:260px;
      max-width:38vw;
      background:rgba(255,255,255,0.65);
      border:1px solid var(--border);
      border-radius:18px;
      padding:14px 12px;
      box-shadow:0 14px 28px rgba(15,23,42,0.12);
      color:var(--ink);
      backdrop-filter: blur(6px);
    }
    .side-title{ font-weight:700; text-align:center; margin-bottom:10px; color:var(--ink); }
    .side-row{ margin:10px 0; }
    .side-label{ font-size:0.85rem; color:var(--ink-sub); margin-bottom:6px; }
    .side-input{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#fff;
      font-size:0.95rem;
    }
    .side-btn{
      width:100%;
      border:none;
      border-radius:12px;
      background:var(--primary);
      color:#fff;
      font-size:0.95rem;
      font-weight:700;
      padding:10px 10px;
      cursor:pointer;
      box-shadow:0 10px 20px rgba(79,70,229,0.22);
      transition:transform 0.05s ease, opacity 0.15s;
    }
    .side-btn:active{ transform:translateY(1px); }
    .side-btn.disabled{ opacity:0.35; cursor:default; box-shadow:none; transform:none; }
    .side-two{ display:flex; gap:10px; }
    .side-two .side-btn{ width:auto; flex:1 1 0; }
    .side-divider{ height:1px; background:var(--border); margin:12px 0; opacity:0.9; }
    .side-hint{ font-size:0.82rem; color:var(--ink-sub); line-height:1.4; min-height:2.8em; margin-top:8px; white-space:pre-wrap; }
    @media (max-width:820px){
      body{ align-items:flex-start; }
      .shell{ flex-direction:column; max-width:700px; }
      .side{ width:100%; max-width:none; }
      .side-two{ gap:8px; }
    }

  </style>
</head>
<body>
  <div class="shell">
    <div class="shell-main">
      
        <div class="app">
          <div class="app-title">語いクイズ</div>
      
          <div class="status-row">
            <div>もんだい <span id="qNumber">1</span> / <span id="qTotal">0</span></div>
          </div>
      
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
      
          <div class="card">
            <div class="question-text" id="questionText"></div>
            <div class="hint" id="questionHint"></div>
      
            <div class="choices" id="choicesContainer"></div>
      
            <div class="feedback" id="feedback"></div>
      
            <div class="nav-row">
              <div class="score-text" id="scoreText">せいかい：0 もん</div>
              <button class="next-btn disabled" id="nextBtn" type="button">
                こたえを えらんでね
              </button>
            </div>
          </div>
      
          <div class="roulette">
            <div class="roulette-label">せいかいしたら しかけが でるよ</div>
            <div class="roulette-wheel disabled" id="rouletteWheel">？</div>
            <div class="card-container" id="cardContainer"></div>
          </div>
      
          <div class="result" id="resultArea"></div>
        </div>
    </div>

    <aside class="side" aria-label="オンライン設定">
      <div class="side-title">オンライン設定</div>

      <div class="side-row">
        <div class="side-label">部屋番号</div>
        <input id="roomInput" class="side-input" placeholder="部屋番号（例: class1）" />
      </div>

      <div class="side-row">
        <button id="makeRoomUrlBtn" class="side-btn" type="button">URL作成</button>
      </div>

      <div class="side-row">
        <div class="side-label">P1用URL</div>
        <input id="urlP1" class="side-input" readonly />
      </div>

      <div class="side-row">
        <div class="side-label">P2用URL</div>
        <input id="urlP2" class="side-input" readonly />
      </div>

      <div class="side-divider"></div>

      <div class="side-row side-two">
        <button id="onlineStartBtn" class="side-btn" type="button">スタート</button>
        <button id="onlineResetBtn" class="side-btn" type="button">リセット</button>
      </div>

      <div class="side-hint" id="onlineHint"></div>
    </aside>
  </div>

  <script>
// 📚 ルビ入り語いクイズ（①〜㊺）※見出し語は問題文の冒頭に出さない
    
    // ============================================================
    // ★オンライン対戦：Firebase Realtime Database（追加）
    //   URL: ?room=部屋名&me=1  /  ?room=部屋名&me=2
    //   - P1のみ「スタート」「リセット」可
    //   - ターン制（activePlayer: 1 or 2）
    //   - すべての状態を同期（クイズ進行・得点・ギミック）
    //   - Firebase失敗時は自動でオフラインへフォールバック
    // ============================================================

    const firebaseConfig = {
      apiKey: "AIzaSyBtKWi2tXanWuDf_Du5C9tr5ZwOAfNBRIs",
      authDomain: "goi-battle-g3.firebaseapp.com",
      projectId: "goi-battle-g3",
      storageBucket: "goi-battle-g3.firebasestorage.app",
      messagingSenderId: "1052102588017",
      appId: "1:1052102588017:web:e8a09649466f4504f08dd0",
      measurementId: "G-Y7TQVZ2R2V"
    };

    // URL params
    const __params = new URLSearchParams(location.search);
    const __ROOM = (__params.get("room") || "").trim();
    const __ME = Number(__params.get("me") || 0);
    const __ONLINE_INTENT = !!__ROOM && (__ME === 1 || __ME === 2);
    const __IS_P1 = (__ME === 1);

    // Right panel elements
    const __roomInputEl = document.getElementById("roomInput");
    const __makeRoomUrlBtn = document.getElementById("makeRoomUrlBtn");
    const __urlP1El = document.getElementById("urlP1");
    const __urlP2El = document.getElementById("urlP2");
    const __onlineStartBtn = document.getElementById("onlineStartBtn");
    const __onlineResetBtn = document.getElementById("onlineResetBtn");
    const __onlineHintEl = document.getElementById("onlineHint");

    function __setSideHint(msg){
      if(!__onlineHintEl) return;
      __onlineHintEl.textContent = msg || "";
    }
    function __setBtnEnabled(btn, enabled){
      if(!btn) return;
      if(enabled) btn.classList.remove("disabled");
      else btn.classList.add("disabled");
    }
    function __buildRoomUrls(room){
      const base = location.origin + location.pathname;
      return {
        p1: `${base}?room=${encodeURIComponent(room)}&me=1`,
        p2: `${base}?room=${encodeURIComponent(room)}&me=2`
      };
    }

    if(__roomInputEl) __roomInputEl.value = __ROOM || "";
    if(__ROOM){
      const u = __buildRoomUrls(__ROOM);
      if(__urlP1El) __urlP1El.value = u.p1;
      if(__urlP2El) __urlP2El.value = u.p2;
    }

    if(__makeRoomUrlBtn){
      __makeRoomUrlBtn.addEventListener("click", ()=>{
        const room = (__roomInputEl?.value || "").trim();
        if(!room){ __setSideHint("部屋番号を入力してください。"); return; }
        const u = __buildRoomUrls(room);
        if(__urlP1El) __urlP1El.value = u.p1;
        if(__urlP2El) __urlP2El.value = u.p2;
        try{
          navigator.clipboard?.writeText(u.p1);
          __setSideHint("P1用URLを作成しました。（クリップボードにコピーしました）");
        }catch{
          __setSideHint("P1用URLを作成しました。");
        }
      });
    }

    // Online runtime state
    const ONLINE = {
      enabled:false,
      ready:false,
      suppress:false,
      lastRev:0,
      room:__ROOM,
      me:__ME,
      isP1:__IS_P1,
      db:null,
      roomRef:null,
      stateRef:null,
      metaRef:null,
      activePlayer:1
    };

    function __canOperateNow(){
      if(!ONLINE.enabled) return true; // offline: anyone can operate (as before)
      return ONLINE.me === ONLINE.activePlayer;
    }

    // Firebase (compat) load via dynamic <script> to keep single-file and non-module
    function __loadScript(src){
      return new Promise((resolve, reject)=>{
        const s=document.createElement("script");
        s.src=src; s.async=true;
        s.onload=()=>resolve();
        s.onerror=()=>reject(new Error("load failed: "+src));
        document.head.appendChild(s);
      });
    }

    async function __initFirebase(){
      if(!__ONLINE_INTENT){
        ONLINE.enabled=false;
        ONLINE.ready=false;
        __setSideHint("オフライン（URLに room / me がありません）");
        __setBtnEnabled(__onlineStartBtn, true);
        __setBtnEnabled(__onlineResetBtn, true);
        return false;
      }

      __setSideHint("オンライン初期化中…");
      try{
        // Firebase v10 compat (namespaced)
        await __loadScript("https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js");
        await __loadScript("https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js");

        // eslint-disable-next-line no-undef
        firebase.initializeApp(firebaseConfig);
        // eslint-disable-next-line no-undef
        ONLINE.db = firebase.database();

        ONLINE.roomRef = ONLINE.db.ref("rooms/"+ONLINE.room);
        ONLINE.stateRef = ONLINE.db.ref("rooms/"+ONLINE.room+"/state");
        ONLINE.metaRef  = ONLINE.db.ref("rooms/"+ONLINE.room+"/meta");

        ONLINE.enabled=true;
        ONLINE.ready=true;

        __setSideHint(`オンライン接続：room=${ONLINE.room} / me=${ONLINE.me}`);
        // P1のみStart/Reset有効
        __setBtnEnabled(__onlineStartBtn, ONLINE.isP1);
        __setBtnEnabled(__onlineResetBtn, ONLINE.isP1);

        return true;
      }catch(e){
        console.warn("Firebase init failed -> offline", e);
        ONLINE.enabled=false;
        ONLINE.ready=false;
        __setSideHint("オンライン初期化に失敗しました。オフラインで動作します。");
        __setBtnEnabled(__onlineStartBtn, true);
        __setBtnEnabled(__onlineResetBtn, true);
        return false;
      }
    }

    function __pushState(state){
      if(!ONLINE.enabled) return;
      if(ONLINE.suppress) return;
      const rev = Date.now();
      ONLINE.lastRev = rev;
      const payload = Object.assign({}, state, { __rev: rev });
      ONLINE.metaRef.set({ rev: rev, updatedAt: Date.now() });
      ONLINE.stateRef.set(payload);
    }

    function __applyState(remote){
      if(!remote) return;
      const rev = Number(remote.__rev || 0);
      if(rev && rev <= ONLINE.lastRev) return;

      ONLINE.suppress = true;
      try{
        // Apply core quiz variables
        if(typeof remote.activePlayer === "number") ONLINE.activePlayer = remote.activePlayer;

        if(typeof remote.currentIndex === "number") currentIndex = remote.currentIndex;
        if(typeof remote.score === "number") score = remote.score;
        if(typeof remote.answeredCurrent === "boolean") answeredCurrent = remote.answeredCurrent;
        if(Array.isArray(remote.quizOrderIdx)){
          quizOrder = remote.quizOrderIdx.map(i => questions[i]).filter(Boolean);
        }
        if(typeof remote.currentCorrectIndex === "number") currentCorrectIndex = remote.currentCorrectIndex;

        // Gimmick states
        if(typeof remote.currentGimmickType === "string" || remote.currentGimmickType === null){
          currentGimmickType = remote.currentGimmickType;
        }
        if(typeof remote.gimmickEnabled === "boolean") gimmickEnabled = remote.gimmickEnabled;
        if(typeof remote.gimmickSpinning === "boolean") gimmickSpinning = remote.gimmickSpinning;
        if(typeof remote.rouletteValue === "number") rouletteValue = remote.rouletteValue;
        if(typeof remote.diceValue === "number") diceValue = remote.diceValue;
        if(typeof remote.cardChosen === "boolean") cardChosen = remote.cardChosen;

        // Card numbers and selected
        if(Array.isArray(remote.cardNums) && cardContainerEl){
          // rebuild cards
          cardContainerEl.innerHTML = "";
          cardContainerEl.style.display = "flex";
          if (rouletteWheelEl) {
            rouletteWheelEl.classList.add("disabled");
            rouletteWheelEl.style.display = "none";
          }
          remote.cardNums.forEach((num)=>{
            const card=document.createElement("div");
            card.className="card-option";
            card.textContent = remote.cardChosen ? String(num) : "？";
            card.dataset.value = String(num);
            card.classList.add("disabled");
            if(remote.cardChosen && String(remote.cardSelected) === String(num)){
              card.classList.add("selected");
            }
            cardContainerEl.appendChild(card);
          });
          if(gimmickLabelEl){
            if(remote.cardChosen){
              gimmickLabelEl.textContent = `えらんだ すうじ：${remote.cardSelected}`;
            }else{
              gimmickLabelEl.textContent = "カードをえらんでね";
            }
          }
        }

        // Treasure result
        if(typeof remote.treasureNum === "number" && rouletteWheelEl){
          rouletteWheelEl.textContent = "📦 → " + remote.treasureNum;
        }

        // Update UI
        if(qTotalEl) qTotalEl.textContent = (quizOrder?.length || questions.length).toString();
        if(scoreTextEl) scoreTextEl.textContent = `せいかい：${score} もん`;

        updateProgress();
        renderQuestion();
        // Ensure gimmick label baseline if needed
        if(!currentGimmickType && gimmickLabelEl){
          gimmickLabelEl.textContent = "せいかいしたら しかけが でるよ";
        }

      }finally{
        ONLINE.suppress = false;
        ONLINE.lastRev = rev || ONLINE.lastRev;
      }
    }

    function __collectState(extra){
      // convert quizOrder objects back to indices (stable)
      const quizOrderIdx = (quizOrder || []).map(q => questions.indexOf(q)).map(i => (i<0?0:i));
      const base = {
        activePlayer: ONLINE.activePlayer || 1,
        currentIndex,
        score,
        answeredCurrent,
        quizOrderIdx,
        currentCorrectIndex,
        currentGimmickType,
        gimmickEnabled,
        gimmickSpinning,
        rouletteValue,
        diceValue,
        cardChosen
      };
      return Object.assign(base, extra || {});
    }

    function __watchRemote(){
      if(!ONLINE.enabled) return;
      ONLINE.stateRef.on("value", (snap)=>{
        const v = snap.val();
        __applyState(v);
        // update hint about turn
        if(ONLINE.enabled){
          const t = ONLINE.activePlayer === ONLINE.me ? "あなたの番です" : "相手の番です";
          __setSideHint(`オンライン接続：room=${ONLINE.room} / me=${ONLINE.me}
${t}`);
        }
      });
    }

    // P1 only controls start/reset via side panel
    if(__onlineStartBtn){
      __onlineStartBtn.addEventListener("click", ()=>{
        if(ONLINE.enabled && !ONLINE.isP1) return;
        restartQuiz(); // existing function
        if(ONLINE.enabled){
          ONLINE.activePlayer = 1;
          __pushState(__collectState({ cardNums:null, cardSelected:null, treasureNum:null }));
        }
      });
    }
    if(__onlineResetBtn){
      __onlineResetBtn.addEventListener("click", ()=>{
        if(ONLINE.enabled && !ONLINE.isP1) return;
        restartQuiz();
        if(ONLINE.enabled){
          ONLINE.activePlayer = 1;
          __pushState(__collectState({ cardNums:null, cardSelected:null, treasureNum:null }));
        }
      });
    }

const questions = [
      {
        // ① 高熱
        text: `<ruby>朝<rt>あさ</rt></ruby>から<ruby>体<rt>からだ</rt></ruby>がとてもあつく、<ruby>頭<rt>あたま</rt></ruby>がぼーっとして<ruby>立<rt>た</rt></ruby>ち<ruby>上<rt>あ</rt></ruby>がるのもつらい<ruby>状態<rt>じょうたい</rt></ruby>です。<ruby>体温計<rt>たいおんけい</rt></ruby>で<ruby>測<rt>はか</rt></ruby>ると、38<ruby>度<rt>ど</rt></ruby>をこえていました。この<ruby>体<rt>からだ</rt></ruby>のようすを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>発汗<rt>はっかん</rt></ruby>`,
          `<ruby>高熱<rt>こうねつ</rt></ruby>`,
          `<ruby>冷<rt>ひ</rt></ruby>え`
        ],
        correctIndex: 1
      },
      {
        // ② 都道府県
        text: `<ruby>日本<rt>にほん</rt></ruby>の<ruby>地図<rt>ちず</rt></ruby>を<ruby>見<rt>み</rt></ruby>ると、<ruby>全国<rt>ぜんこく</rt></ruby>がいくつもの<ruby>区切<rt>くぎ</rt></ruby>られた<ruby>場所<rt>ばしょ</rt></ruby>に<ruby>分<rt>わ</rt></ruby>かれています。<ruby>群馬<rt>ぐんま</rt></ruby>や<ruby>奈良<rt>なら</rt></ruby>のように、<ruby>日本<rt>にほん</rt></ruby>の<ruby>中<rt>なか</rt></ruby>の<ruby>大<rt>おお</rt></ruby>きな<ruby>地域<rt>ちいき</rt></ruby>の<ruby>区分<rt>くぶん</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>市町村<rt>しちょうそん</rt></ruby>`,
          `<ruby>地方<rt>ちほう</rt></ruby>`,
          `<ruby>都道府県<rt>とどうふけん</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ③ 児童生徒
        text: `<ruby>小学校<rt>しょうがっこう</rt></ruby>や<ruby>中学校<rt>ちゅうがっこう</rt></ruby>で、<ruby>毎日<rt>まいにち</rt></ruby><ruby>勉強<rt>べんきょう</rt></ruby>や<ruby>生活<rt>せいかつ</rt></ruby>をしている<ruby>子<rt>こ</rt></ruby>どもたちをまとめて<ruby>表<rt>あらわ</rt></ruby>すとき、どの<ruby>言<rt>い</rt></ruby>い<ruby>方<rt>かた</rt></ruby>がいちばん<ruby>合<rt>あ</rt></ruby>っているでしょう。`,
        choices: [
          `<ruby>学年<rt>がくねん</rt></ruby>`,
          `<ruby>児童生徒<rt>じどうせいと</rt></ruby>`,
          `<ruby>先生方<rt>せんせいがた</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ④ 関係
        text: `クラスの<ruby>友<rt>とも</rt></ruby>だちと、けんかをしたり<ruby>仲<rt>なか</rt></ruby>よくしたりしながら、つながりをもって<ruby>生活<rt>せいかつ</rt></ruby>しています。<ruby>人<rt>ひと</rt></ruby>と<ruby>人<rt>ひと</rt></ruby>とのつながりを<ruby>表<rt>あらわ</rt></ruby>す<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>友達<rt>ともだち</rt></ruby>`,
          `<ruby>関係<rt>かんけい</rt></ruby>`,
          `<ruby>会話<rt>かいわ</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑤ 漢字辞典
        text: `<ruby>知<rt>し</rt></ruby>らない<ruby>漢字<rt>かんじ</rt></ruby>の<ruby>読<rt>よ</rt></ruby>み<ruby>方<rt>かた</rt></ruby>や<ruby>意味<rt>いみ</rt></ruby>、<ruby>画数<rt>かくすう</rt></ruby>などを<ruby>調<rt>しら</rt></ruby>べたいときに<ruby>使<rt>つか</rt></ruby>う<ruby>本<rt>ほん</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>図鑑<rt>ずかん</rt></ruby>`,
          `<ruby>漢字辞典<rt>かんじじてん</rt></ruby>`,
          `<ruby>物語集<rt>ものがたりしゅう</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑥ 国語辞典
        text: `ある<ruby>言葉<rt>ことば</rt></ruby>の<ruby>意味<rt>いみ</rt></ruby>や<ruby>使<rt>つか</rt></ruby>い<ruby>方<rt>かた</rt></ruby>をくわしく<ruby>調<rt>しら</rt></ruby>べたいときに<ruby>使<rt>つか</rt></ruby>う、<ruby>本<rt>ほん</rt></ruby>の<ruby>種類<rt>しゅるい</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>国語辞典<rt>こくごじてん</rt></ruby>`,
          `<ruby>地図帳<rt>ちずちょう</rt></ruby>`,
          `<ruby>問題集<rt>もんだいしゅう</rt></ruby>`
        ],
        correctIndex: 0
      },
      {
        // ⑦ 成人式
        text: `20<ruby>歳<rt>さい</rt></ruby>になる<ruby>人<rt>ひと</rt></ruby>たちが<ruby>集<rt>あつ</rt></ruby>まって、<ruby>大人<rt>おとな</rt></ruby>になったお<ruby>祝<rt>いわ</rt></ruby>いをする<ruby>行事<rt>ぎょうじ</rt></ruby>があります。この<ruby>行事<rt>ぎょうじ</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>文化祭<rt>ぶんかさい</rt></ruby>`,
          `<ruby>卒業式<rt>そつぎょうしき</rt></ruby>`,
          `<ruby>成人式<rt>せいじんしき</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ⑧ 訓練
        text: `<ruby>火事<rt>かじ</rt></ruby>や<ruby>地震<rt>じしん</rt></ruby>にそなえて、<ruby>学校<rt>がっこう</rt></ruby>でにげる<ruby>練習<rt>れんしゅう</rt></ruby>をくり<ruby>返<rt>かえ</rt></ruby>し<ruby>行<rt>おこな</rt></ruby>います。このように、<ruby>本番<rt>ほんばん</rt></ruby>にそなえて<ruby>練習<rt>れんしゅう</rt></ruby>することを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>訓練<rt>くんれん</rt></ruby>`,
          `<ruby>試合<rt>しあい</rt></ruby>`,
          `<ruby>発表<rt>はっぴょう</rt></ruby>`
        ],
        correctIndex: 0
      },
      {
        // ⑨ 人類
        text: `<ruby>大昔<rt>おおむかし</rt></ruby>から<ruby>現在<rt>げんざい</rt></ruby>まで、<ruby>地球<rt>ちきゅう</rt></ruby>で<ruby>生<rt>い</rt></ruby>きてきたすべての<ruby>人間<rt>にんげん</rt></ruby>の<ruby>仲間<rt>なかま</rt></ruby>をまとめて<ruby>表<rt>あらわ</rt></ruby>す<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>生物<rt>せいぶつ</rt></ruby>`,
          `<ruby>人類<rt>じんるい</rt></ruby>`,
          `<ruby>動物<rt>どうぶつ</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑩ 順番
        text: `ならんで<ruby>歩<rt>ある</rt></ruby>くときに、<ruby>前<rt>まえ</rt></ruby>の<ruby>人<rt>ひと</rt></ruby>の<ruby>次<rt>つぎ</rt></ruby>に<ruby>自分<rt>じぶん</rt></ruby>が<ruby>入<rt>はい</rt></ruby>るなど、<ruby>決<rt>き</rt></ruby>められたならび<ruby>方<rt>かた</rt></ruby>があります。このならびの<ruby>決<rt>き</rt></ruby>まりを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>列<rt>れつ</rt></ruby>`,
          `<ruby>順番<rt>じゅんばん</rt></ruby>`,
          `<ruby>方向<rt>ほうこう</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑪ 愛情
        text: `<ruby>家族<rt>かぞく</rt></ruby>が<ruby>病気<rt>びょうき</rt></ruby>のときに<ruby>心配<rt>しんぱい</rt></ruby>して<ruby>世話<rt>せわ</rt></ruby>をしたり、<ruby>相手<rt>あいて</rt></ruby>のことを<ruby>思<rt>おも</rt></ruby>って<ruby>行動<rt>こうどう</rt></ruby>したりする<ruby>気持<rt>きも</rt></ruby>ちを<ruby>表<rt>あらわ</rt></ruby>す<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>表情<rt>ひょうじょう</rt></ruby>`,
          `<ruby>愛情<rt>あいじょう</rt></ruby>`,
          `<ruby>感心<rt>かんしん</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑫ 昨年
        text: `<ruby>今年<rt>ことし</rt></ruby>の<ruby>前<rt>まえ</rt></ruby>の<ruby>年<rt>とし</rt></ruby>のことを<ruby>話<rt>はな</rt></ruby>すときに<ruby>使<rt>つか</rt></ruby>う<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>先月<rt>せんげつ</rt></ruby>`,
          `<ruby>昨年<rt>さくねん</rt></ruby>`,
          `<ruby>明日<rt>あした</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑬ 城下町
        text: `<ruby>昔<rt>むかし</rt></ruby>、お<ruby>城<rt>しろ</rt></ruby>のまわりには、<ruby>家<rt>いえ</rt></ruby>や<ruby>店<rt>みせ</rt></ruby>が<ruby>集<rt>あつ</rt></ruby>まってつくられた<ruby>町<rt>まち</rt></ruby>がありました。こうした<ruby>町<rt>まち</rt></ruby>の<ruby>呼<rt>よ</rt></ruby>び<ruby>方<rt>かた</rt></ruby>としていちばん<ruby>合<rt>あ</rt></ruby>っているものはどれでしょう。`,
        choices: [
          `<ruby>農村<rt>のうそん</rt></ruby>`,
          `<ruby>城下町<rt>じょうかまち</rt></ruby>`,
          `<ruby>港町<rt>みなとまち</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑭ 伝説
        text: `<ruby>昔<rt>むかし</rt></ruby>から<ruby>語<rt>かた</rt></ruby>りつがれてきたふしぎな<ruby>話<rt>はなし</rt></ruby>で、<ruby>本当<rt>ほんとう</rt></ruby>かどうか<ruby>分<rt>わ</rt></ruby>からない<ruby>物語<rt>ものがたり</rt></ruby>のような<ruby>話<rt>はなし</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>記録<rt>きろく</rt></ruby>`,
          `<ruby>伝説<rt>でんせつ</rt></ruby>`,
          `<ruby>事実<rt>じじつ</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑮ 説明
        text: `<ruby>分<rt>わ</rt></ruby>からないことを、<ruby>相手<rt>あいて</rt></ruby>に<ruby>分<rt>わ</rt></ruby>かるように<ruby>言葉<rt>ことば</rt></ruby>で<ruby>伝<rt>つた</rt></ruby>えることを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>説明<rt>せつめい</rt></ruby>`,
          `<ruby>相談<rt>そうだん</rt></ruby>`,
          `<ruby>指示<rt>しじ</rt></ruby>`
        ],
        correctIndex: 0
      },
      {
        // ⑯ 好物
        text: `その<ruby>人<rt>ひと</rt></ruby>がとくに<ruby>好<rt>す</rt></ruby>きで、<ruby>進<rt>すす</rt></ruby>んで<ruby>食<rt>た</rt></ruby>べたがる<ruby>食<rt>た</rt></ruby>べ<ruby>物<rt>もの</rt></ruby>のことを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>名物<rt>めいぶつ</rt></ruby>`,
          `<ruby>好物<rt>こうぶつ</rt></ruby>`,
          `<ruby>食品<rt>しょくひん</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑰ 印刷
        text: `<ruby>紙<rt>かみ</rt></ruby>に<ruby>文字<rt>もじ</rt></ruby>や<ruby>絵<rt>え</rt></ruby>を、<ruby>機械<rt>きかい</rt></ruby>を<ruby>使<rt>つか</rt></ruby>ってたくさんおなじようにうつし<ruby>取<rt>と</rt></ruby>る<ruby>作業<rt>さぎょう</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>文書<rt>ぶんしょ</rt></ruby>`,
          `<ruby>印刷<rt>いんさつ</rt></ruby>`,
          `<ruby>作成<rt>さくせい</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑱ 要求
        text: `してほしいことや、のぞんでいることを<ruby>相手<rt>あいて</rt></ruby>に<ruby>強<rt>つよ</rt></ruby>く<ruby>伝<rt>つた</rt></ruby>えるときの<ruby>言<rt>い</rt></ruby>い<ruby>方<rt>かた</rt></ruby>として<ruby>合<rt>あ</rt></ruby>っているものはどれでしょう。`,
        choices: [
          `<ruby>感想<rt>かんそう</rt></ruby>`,
          `<ruby>要求<rt>ようきゅう</rt></ruby>`,
          `<ruby>反省<rt>はんせい</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ⑲ 目的
        text: `<ruby>遠足<rt>えんそく</rt></ruby>に<ruby>行<rt>い</rt></ruby>く<ruby>理由<rt>りゆう</rt></ruby>が「みんなで<ruby>自然<rt>しぜん</rt></ruby>を<ruby>学<rt>まな</rt></ruby>ぶため」のように、<ruby>行動<rt>こうどう</rt></ruby>をするもとになるねらいのことを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>予定<rt>よてい</rt></ruby>`,
          `<ruby>理由<rt>りゆう</rt></ruby>`,
          `<ruby>目的<rt>もくてき</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ⑳ 必要
        text: `なくてはならないものや、どうしてもいるものを<ruby>表<rt>あらわ</rt></ruby>す<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>便利<rt>べんり</rt></ruby>`,
          `<ruby>大切<rt>たいせつ</rt></ruby>`,
          `<ruby>必要<rt>ひつよう</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㉑ 最初
        text: `かけっこでスタートの<ruby>合図<rt>あいず</rt></ruby>が<ruby>鳴<rt>な</rt></ruby>ったとき、いちばん<ruby>先<rt>さき</rt></ruby>に<ruby>走<rt>はし</rt></ruby>り<ruby>出<rt>だ</rt></ruby>す<ruby>位置<rt>いち</rt></ruby>や、いちばんはじめのことを<ruby>表<rt>あらわ</rt></ruby>す<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>途中<rt>とちゅう</rt></ruby>`,
          `<ruby>最初<rt>さいしょ</rt></ruby>`,
          `<ruby>最後<rt>さいご</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉒ 案内
        text: `<ruby>駅<rt>えき</rt></ruby>で<ruby>道<rt>みち</rt></ruby>が<ruby>分<rt>わ</rt></ruby>からない<ruby>人<rt>ひと</rt></ruby>に、<ruby>行<rt>い</rt></ruby>き<ruby>先<rt>さき</rt></ruby>までの<ruby>道<rt>みち</rt></ruby>をおしえてあげるような<ruby>行動<rt>こうどう</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>案内<rt>あんない</rt></ruby>`,
          `<ruby>提出<rt>ていしゅつ</rt></ruby>`,
          `<ruby>指導<rt>しどう</rt></ruby>`
        ],
        correctIndex: 0
      },
      {
        // ㉓ 商店街
        text: `<ruby>野菜屋<rt>やさいや</rt></ruby>さんやおかし<ruby>屋<rt>や</rt></ruby>さん、<ruby>文房具店<rt>ぶんぼうぐてん</rt></ruby>など、たくさんの<ruby>店<rt>みせ</rt></ruby>が<ruby>道<rt>みち</rt></ruby>の<ruby>両側<rt>りょうがわ</rt></ruby>にならんでいる<ruby>場所<rt>ばしょ</rt></ruby>があります。このような<ruby>場所<rt>ばしょ</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>住宅地<rt>じゅうたくち</rt></ruby>`,
          `<ruby>商店街<rt>しょうてんがい</rt></ruby>`,
          `<ruby>工業地<rt>こうぎょうち</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉔ 試験
        text: `<ruby>学<rt>まな</rt></ruby>んだことがどれくらい<ruby>身<rt>み</rt></ruby>についているかをたしかめるために、<ruby>学校<rt>がっこう</rt></ruby>で<ruby>問題<rt>もんだい</rt></ruby>を<ruby>解<rt>と</rt></ruby>く<ruby>時間<rt>じかん</rt></ruby>があります。このようなとりくみを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>練習<rt>れんしゅう</rt></ruby>`,
          `<ruby>発表<rt>はっぴょう</rt></ruby>`,
          `<ruby>試験<rt>しけん</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㉕ 選挙
        text: `クラスの<ruby>代表<rt>だいひょう</rt></ruby>や<ruby>市<rt>し</rt></ruby>のリーダーなどを<ruby>決<rt>き</rt></ruby>めるとき、みんなが<ruby>投票<rt>とうひょう</rt></ruby>して<ruby>選<rt>えら</rt></ruby>ぶ<ruby>方法<rt>ほうほう</rt></ruby>があります。この<ruby>決<rt>き</rt></ruby>め<ruby>方<rt>かた</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>相談<rt>そうだん</rt></ruby>`,
          `<ruby>選挙<rt>せんきょ</rt></ruby>`,
          `<ruby>指名<rt>しめい</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉖ 観客
        text: `サッカーやコンサートで、プレーや<ruby>演奏<rt>えんそう</rt></ruby>を<ruby>見<rt>み</rt></ruby>ておうえんしている<ruby>人<rt>ひと</rt></ruby>たちをまとめて<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>出場者<rt>しゅつじょうしゃ</rt></ruby>`,
          `<ruby>係員<rt>かかりいん</rt></ruby>`,
          `<ruby>観客<rt>かんきゃく</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㉗ 静電気
        text: `ドアノブにさわったときに「パチッ」として、<ruby>指<rt>ゆび</rt></ruby>がしびれることがあります。このときに<ruby>起<rt>お</rt></ruby>きている<ruby>現象<rt>げんしょう</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>電流<rt>でんりゅう</rt></ruby>`,
          `<ruby>静電気<rt>せいでんき</rt></ruby>`,
          `<ruby>磁力<rt>じりょく</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉘ 国旗
        text: `オリンピックなどで、その<ruby>国<rt>くに</rt></ruby>を<ruby>表<rt>あらわ</rt></ruby>すためにかかげられている<ruby>旗<rt>はた</rt></ruby>があります。この<ruby>旗<rt>はた</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>名札<rt>なふだ</rt></ruby>`,
          `<ruby>政治<rt>せいじ</rt></ruby>`,
          `<ruby>国旗<rt>こっき</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㉙ 材料
        text: `カレーをつくるときの<ruby>肉<rt>にく</rt></ruby>や<ruby>野菜<rt>やさい</rt></ruby>のように、<ruby>料理<rt>りょうり</rt></ruby>や<ruby>工作<rt>こうさく</rt></ruby>のもとになるものを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>道具<rt>どうぐ</rt></ruby>`,
          `<ruby>材料<rt>ざいりょう</rt></ruby>`,
          `<ruby>作品<rt>さくひん</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉚ 群馬県
        text: `<ruby>草津温泉<rt>くさつおんせん</rt></ruby>があり、<ruby>関東地方<rt>かんとうちほう</rt></ruby>の<ruby>内陸<rt>ないりく</rt></ruby>に<ruby>位置<rt>いち</rt></ruby>する<ruby>県<rt>けん</rt></ruby>の<ruby>名前<rt>なまえ</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>栃木県<rt>とちぎけん</rt></ruby>`,
          `<ruby>群馬県<rt>ぐんまけん</rt></ruby>`,
          `<ruby>長野県<rt>ながのけん</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉛ 奈良県
        text: `<ruby>大仏<rt>だいぶつ</rt></ruby>があり、しかが<ruby>公園<rt>こうえん</rt></ruby>を<ruby>歩<rt>ある</rt></ruby>いていることで<ruby>知<rt>し</rt></ruby>られている<ruby>県<rt>けん</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>京都府<rt>きょうとふ</rt></ruby>`,
          `<ruby>奈良県<rt>ならけん</rt></ruby>`,
          `<ruby>三重県<rt>みえけん</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉜ 豊富
        text: `<ruby>食<rt>た</rt></ruby>べ<ruby>物<rt>もの</rt></ruby>の<ruby>種類<rt>しゅるい</rt></ruby>が<ruby>多<rt>おお</rt></ruby>く、<ruby>選<rt>えら</rt></ruby>べるものがたくさんあるとき、そのようすを<ruby>表<rt>あらわ</rt></ruby>す<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>不足<rt>ふそく</rt></ruby>`,
          `<ruby>豊富<rt>ほうふ</rt></ruby>`,
          `<ruby>単調<rt>たんちょう</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㉞ 岐阜県
        text: `<ruby>木曽川<rt>きそがわ</rt></ruby>や<ruby>長良川<rt>ながらがわ</rt></ruby>がながれ、<ruby>内陸<rt>ないりく</rt></ruby>に<ruby>位置<rt>いち</rt></ruby>する<ruby>中部地方<rt>ちゅうぶちほう</rt></ruby>の<ruby>県<rt>けん</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>岐阜県<rt>ぎふけん</rt></ruby>`,
          `<ruby>愛知県<rt>あいちけん</rt></ruby>`,
          `<ruby>三重県<rt>みえけん</rt></ruby>`
        ],
        correctIndex: 0
      },
      {
        // ㉟ 季節風
        text: `<ruby>冬<rt>ふゆ</rt></ruby>になると<ruby>日本海側<rt>にほんかいがわ</rt></ruby>に<ruby>冷<rt>つめ</rt></ruby>たいかぜがふき、<ruby>雪<rt>ゆき</rt></ruby>が<ruby>多<rt>おお</rt></ruby>くふります。このように、<ruby>季節<rt>きせつ</rt></ruby>ごとにふく<ruby>向<rt>む</rt></ruby>きが<ruby>変<rt>か</rt></ruby>わるかぜを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>台風<rt>たいふう</rt></ruby>`,
          `<ruby>季節風<rt>きせつふう</rt></ruby>`,
          `<ruby>つむじ風<rt>つむじかぜ</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㊱ 季節
        text: `<ruby>一年<rt>いちねん</rt></ruby>の<ruby>中<rt>なか</rt></ruby>で、<ruby>春<rt>はる</rt></ruby>・<ruby>夏<rt>なつ</rt></ruby>・<ruby>秋<rt>あき</rt></ruby>・<ruby>冬<rt>ふゆ</rt></ruby>のように、<ruby>気温<rt>きおん</rt></ruby>や<ruby>自然<rt>しぜん</rt></ruby>のようすが<ruby>変<rt>か</rt></ruby>わっていくまとまりを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>天候<rt>てんこう</rt></ruby>`,
          `<ruby>月日<rt>つきひ</rt></ruby>`,
          `<ruby>季節<rt>きせつ</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㊲ 特別
        text: `いつもとはちがって、とくに<ruby>大切<rt>たいせつ</rt></ruby>にされたり、めずらしかったりするようすを<ruby>表<rt>あらわ</rt></ruby>す<ruby>言葉<rt>ことば</rt></ruby>はどれでしょう。`,
        choices: [
          `<ruby>普通<rt>ふつう</rt></ruby>`,
          `<ruby>特別<rt>とくべつ</rt></ruby>`,
          `<ruby>同様<rt>どうよう</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㊳ 郡部
        text: `<ruby>市<rt>し</rt></ruby>のように<ruby>人<rt>ひと</rt></ruby>が<ruby>多<rt>おお</rt></ruby>く<ruby>集<rt>あつ</rt></ruby>まっている<ruby>地域<rt>ちいき</rt></ruby>ではなく、<ruby>町<rt>まち</rt></ruby>や<ruby>村<rt>むら</rt></ruby>が<ruby>集<rt>あつ</rt></ruby>まっている<ruby>地域<rt>ちいき</rt></ruby>をまとめて<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>市街地<rt>しがいち</rt></ruby>`,
          `<ruby>郡部<rt>ぐんぶ</rt></ruby>`,
          `<ruby>工業地<rt>こうぎょうち</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㊴ 戦争
        text: `<ruby>国<rt>くに</rt></ruby>どうしや<ruby>大<rt>おお</rt></ruby>きな<ruby>集団<rt>しゅうだん</rt></ruby>どうしが、<ruby>武器<rt>ぶき</rt></ruby>を<ruby>使<rt>つか</rt></ruby>ってあらそうとても<ruby>大<rt>おお</rt></ruby>きなあらそいを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>競争<rt>きょうそう</rt></ruby>`,
          `<ruby>試合<rt>しあい</rt></ruby>`,
          `<ruby>戦争<rt>せんそう</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㊵ 戦争（重複）
        text: `<ruby>昔<rt>むかし</rt></ruby>の<ruby>日本<rt>にほん</rt></ruby>や<ruby>世界<rt>せかい</rt></ruby>の<ruby>歴史<rt>れきし</rt></ruby>で、たくさんの<ruby>人<rt>ひと</rt></ruby>がたたかいにまきこまれ、<ruby>町<rt>まち</rt></ruby>やくらしが<ruby>大<rt>おお</rt></ruby>きく<ruby>変<rt>か</rt></ruby>わった<ruby>出来事<rt>できごと</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>革命<rt>かくめい</rt></ruby>`,
          `<ruby>災害<rt>さいがい</rt></ruby>`,
          `<ruby>戦争<rt>せんそう</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㊶ 最初（重複）
        text: `ながい<ruby>行列<rt>ぎょうれつ</rt></ruby>の<ruby>中<rt>なか</rt></ruby>で、いちばん<ruby>前<rt>まえ</rt></ruby>に<ruby>立<rt>た</rt></ruby>つ<ruby>位置<rt>いち</rt></ruby>や、ものごとがはじまるいちばんはじめの<ruby>部分<rt>ぶぶん</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>最後<rt>さいご</rt></ruby>`,
          `<ruby>中央<rt>ちゅうおう</rt></ruby>`,
          `<ruby>最初<rt>さいしょ</rt></ruby>`
        ],
        correctIndex: 2
      },
      {
        // ㊷ 学校給食
        text: `<ruby>学校<rt>がっこう</rt></ruby>で、ひるにみんなでおなじ<ruby>献立<rt>こんだて</rt></ruby>を<ruby>食<rt>た</rt></ruby>べる<ruby>食事<rt>しょくじ</rt></ruby>のことを<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `お<ruby>弁当<rt>べんとう</rt></ruby>`,
          `<ruby>学校給食<rt>がっこうきゅうしょく</rt></ruby>`,
          `<ruby>外食<rt>がいしょく</rt></ruby>`
        ],
        correctIndex: 1
      },
      {
        // ㊸ 飛行機
        text: `<ruby>空港<rt>くうこう</rt></ruby>を<ruby>出発<rt>しゅっぱつ</rt></ruby>して、<ruby>空<rt>そら</rt></ruby>の<ruby>上<rt>うえ</rt></ruby>をながいきょり<ruby>移動<rt>いどう</rt></ruby>し、<ruby>人<rt>ひと</rt></ruby>や<ruby>荷物<rt>にもつ</rt></ruby>をはこぶ<ruby>大<rt>おお</rt></ruby>きなのりものはどれでしょう。`,
        choices: [
          `<ruby>新幹線<rt>しんかんせん</rt></ruby>`,
          `<ruby>飛行機<rt>ひこうき</rt></ruby>`,
          `フェリー`
        ],
        correctIndex: 1
      },
      {
        // ㊹ 包帯
        text: `けがをしたときに、<ruby>血<rt>ち</rt></ruby>をとめたり、<ruby>傷口<rt>きずぐち</rt></ruby>をまもったりするために<ruby>体<rt>からだ</rt></ruby>にまく<ruby>白<rt>しろ</rt></ruby>い<ruby>布<rt>ぬの</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>絆創膏<rt>ばんそうこう</rt></ruby>`,
          `<ruby>包帯<rt>ほうたい</rt></ruby>`,
          `テープ`
        ],
        correctIndex: 1
      },
      {
        // ㊺ 熱帯
        text: `<ruby>一年中<rt>いちねんじゅう</rt></ruby>あたたかく、<ruby>雨<rt>あめ</rt></ruby>が<ruby>多<rt>おお</rt></ruby>く、ジャングルが<ruby>広<rt>ひろ</rt></ruby>がるような<ruby>地域<rt>ちいき</rt></ruby>の<ruby>気候帯<rt>きこうたい</rt></ruby>を<ruby>何<rt>なん</rt></ruby>というでしょう。`,
        choices: [
          `<ruby>砂漠<rt>さばく</rt></ruby>`,
          `<ruby>森林<rt>しんりん</rt></ruby>`,
          `<ruby>熱帯<rt>ねったい</rt></ruby>`
        ],
        correctIndex: 2
      }
    ];

    // --- クイズ状態＆しかけ設定（ここから下は元のまま） ---
    let currentIndex = 0;
    let score = 0;
    let answeredCurrent = false;

    let quizOrder = [];
    let currentCorrectIndex = 0;

    const qTextEl = document.getElementById("questionText");
    const qHintEl = document.getElementById("questionHint");
    const choicesEl = document.getElementById("choicesContainer");
    const feedbackEl = document.getElementById("feedback");
    const qNumberEl = document.getElementById("qNumber");
    const qTotalEl = document.getElementById("qTotal");
    const progressFillEl = document.getElementById("progressFill");
    const scoreTextEl = document.getElementById("scoreText");
    const nextBtn = document.getElementById("nextBtn");
    const resultArea = document.getElementById("resultArea");
    const rouletteWheelEl = document.getElementById("rouletteWheel");
    const gimmickLabelEl = document.querySelector(".roulette-label");
    const cardContainerEl = document.getElementById("cardContainer");

    const GIMMICK_TYPES = ["roulette", "dice", "treasure", "card"];

    let currentGimmickType = null;
    let gimmickInterval = null;
    let gimmickSpinning = false;
    let gimmickEnabled = false;

    let rouletteValue = 1;
    let diceValue = 1;
    let cardChosen = false;

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function resetGimmick() {
      if (gimmickInterval) {
        clearInterval(gimmickInterval);
        gimmickInterval = null;
      }
      gimmickSpinning = false;
      gimmickEnabled = false;
      currentGimmickType = null;
      rouletteValue = 1;
      diceValue = 1;
      cardChosen = false;

      if (rouletteWheelEl) {
        rouletteWheelEl.textContent = "？";
        rouletteWheelEl.classList.add("disabled");
        rouletteWheelEl.style.display = "inline-flex";
      }
      if (cardContainerEl) {
        cardContainerEl.innerHTML = "";
        cardContainerEl.style.display = "none";
      }
      if (gimmickLabelEl) {
        gimmickLabelEl.textContent = "せいかいしたら しかけが でるよ";
      }
    }

    function setupCardGimmick() {
      if (!cardContainerEl) return;

      gimmickEnabled = true;
      cardChosen = false;

      if (rouletteWheelEl) {
        rouletteWheelEl.classList.add("disabled");
        rouletteWheelEl.style.display = "none";
      }
      cardContainerEl.style.display = "flex";
      cardContainerEl.innerHTML = "";

      const nums = [];
      while (nums.length < 3) {
        const n = Math.floor(Math.random() * 10) + 1;
        if (!nums.includes(n)) nums.push(n);
      }

      nums.forEach
      if (ONLINE.enabled) { __pushState(__collectState({ cardNums: nums, cardSelected: null })); }

      nums.forEach(num => {
        const card = document.createElement("div");
        card.className = "card-option";
        card.textContent = "？";
        card.dataset.value = String(num);

        card.addEventListener("click", () => {
          if (!gimmickEnabled || cardChosen) return;

          cardChosen = true;
          gimmickEnabled = false;

          const value = card.dataset.value;

          const allCards = Array.from(
            cardContainerEl.getElementsByClassName("card-option")
          );
          allCards.forEach(c => {
            c.classList.add("disabled");
          });

          card.classList.add("selected");
          card.style.transform = "scale(0.9)";
          setTimeout(() => {
            card.textContent = value;
            card.style.transform = "scale(1)";
          }, 120);

          if (gimmickLabelEl) {
            gimmickLabelEl.textContent = `えらんだ すうじ：${value}`;
          }
        
          if (ONLINE.enabled) { __pushState(__collectState({ cardNums: Array.from(cardContainerEl.querySelectorAll(".card-option")).map(c=>Number(c.dataset.value)), cardSelected: Number(value) })); }
});

        cardContainerEl.appendChild(card);
      });
    }

    function enableGimmickAfterCorrect() {
      if (!rouletteWheelEl || !gimmickLabelEl) return;

      currentGimmickType =
        GIMMICK_TYPES[Math.floor(Math.random() * GIMMICK_TYPES.length)];
      gimmickSpinning = false;

      
      if (ONLINE.enabled) { __pushState(__collectState()); }
switch (currentGimmickType) {
        case "roulette":
          gimmickEnabled = true;
          rouletteWheelEl.classList.remove("disabled");
          gimmickLabelEl.textContent = "ルーレットを まわそう！ 🎯";
          rouletteWheelEl.textContent = "▶";
          break;
        case "dice":
          gimmickEnabled = true;
          rouletteWheelEl.classList.remove("disabled");
          gimmickLabelEl.textContent = "サイコロを ふろう！ 🎲";
          rouletteWheelEl.textContent = "🎲";
          break;
        case "treasure":
          gimmickEnabled = true;
          rouletteWheelEl.classList.remove("disabled");
          gimmickLabelEl.textContent = "たからばこを あけてみよう！ 📦";
          rouletteWheelEl.textContent = "📦";
          break;
        case "card":
          gimmickLabelEl.textContent = "カードを 1まい えらぼう！ 🎴";
          setupCardGimmick();
          break;
      }
    }

    function startSpin() {
      if (!rouletteWheelEl || !currentGimmickType) return;

      if (gimmickInterval) {
        clearInterval(gimmickInterval);
        gimmickInterval = null;
      }
      gimmickSpinning = true;
      rouletteValue = 1;
      diceValue = 1;

      gimmickInterval = setInterval(() => {
        switch (currentGimmickType) {
          case "roulette":
            rouletteValue++;
            if (rouletteValue > 10) rouletteValue = 1;
            rouletteWheelEl.textContent = String(rouletteValue);
            break;
          case "dice":
            diceValue = Math.floor(Math.random() * 6) + 1;
            rouletteWheelEl.textContent = "🎲 " + diceValue;
            break;
        }
      }, 80);
    }

    function stopSpin() {
      if (gimmickInterval) {
        clearInterval(gimmickInterval);
        gimmickInterval = null;
      }
      gimmickSpinning = false;
      gimmickEnabled = false;
      if (rouletteWheelEl) {
        rouletteWheelEl.classList.add("disabled");
      }
    }
      if (ONLINE.enabled) { __pushState(__collectState()); }


    function revealTreasureOnce() {
      if (!rouletteWheelEl) return;

      gimmickSpinning = true;
      gimmickEnabled = false;
      rouletteWheelEl.classList.add("disabled");

      const num = Math.floor(Math.random() * 10) + 1;
      rouletteWheelEl.textContent = "📦 → " + num;
    
      if (ONLINE.enabled) { __pushState(__collectState({ treasureNum: num })); }
}

    if (rouletteWheelEl) {
      rouletteWheelEl.addEventListener("click", () => {
        
        if (ONLINE.enabled && !__canOperateNow()) return;
if (!gimmickEnabled || !currentGimmickType) return;
        if (currentGimmickType === "card") return;

        if (currentGimmickType === "treasure") {
          if (!gimmickSpinning) {
            revealTreasureOnce();
          }
        } else {
          if (!gimmickSpinning) {
            startSpin();
          } else {
            stopSpin();
          }
        }
      });
    }

    function updateProgress() {
      const total = quizOrder.length || questions.length;
      const percent = (currentIndex / total) * 100;
      progressFillEl.style.width = percent + "%";
    }

    function renderQuestion() {
      const q = quizOrder[currentIndex];
      qNumberEl.textContent = (currentIndex + 1).toString();
      updateProgress();

      qTextEl.innerHTML = q.text;
      qHintEl.textContent = q.hint || "";
      feedbackEl.innerHTML = "";
      feedbackEl.className = "feedback";
      resultArea.innerHTML = "";

      resetGimmick();

      choicesEl.innerHTML = "";
      const choiceOrder = shuffle([0, 1, 2]);
      currentCorrectIndex = 0;

      choiceOrder.forEach((choiceIdx, buttonIdx) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "choice-btn";

        const labelSpan = document.createElement("span");
        labelSpan.className = "label";
        labelSpan.innerHTML = q.choices[choiceIdx];

        const markSpan = document.createElement("span");
        markSpan.className = "mark";
        markSpan.textContent = String.fromCharCode(65 + buttonIdx);

        btn.appendChild(labelSpan);
        btn.appendChild(markSpan);

        if (choiceIdx === q.correctIndex) {
          currentCorrectIndex = buttonIdx;
        }

        btn.addEventListener("click", () => handleChoice(buttonIdx));
        choicesEl.appendChild(btn);
      });

      nextBtn.textContent =
        currentIndex === quizOrder.length - 1
          ? "さいごの けっか を みる"
          : "えらんだら つぎへ ➜";
      nextBtn.classList.add("disabled");
      answeredCurrent = false;
    }

    function handleChoice(buttonIndex) {
      if (answeredCurrent) return;
      const buttons = Array.from(
        choicesEl.getElementsByClassName("choice-btn")
      );
      answeredCurrent = true;

      
      if (ONLINE.enabled) { __pushState(__collectState()); }
buttons.forEach(btn => btn.classList.add("disabled"));

      if (buttonIndex === currentCorrectIndex) {
        score++;
        scoreTextEl.textContent = `せいかい：${score} もん`;
        feedbackEl.textContent = "⭕ 正解！";
        feedbackEl.className = "feedback correct";
        buttons[buttonIndex].classList.add("correct");
        enableGimmickAfterCorrect();
      } else {
        feedbackEl.textContent = "❌ ざんねん。";
        feedbackEl.className = "feedback wrong";
        buttons[buttonIndex].classList.add("wrong");
        const correctBtn = buttons[currentCorrectIndex];
        if (correctBtn) correctBtn.classList.add("correct");
        resetGimmick();
      }

      nextBtn.classList.remove("disabled");
    }

    nextBtn.addEventListener("click", () => {
      
      if (ONLINE.enabled && !__canOperateNow()) return;
if (nextBtn.classList.contains("disabled")) return;

      if (currentIndex < quizOrder.length - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        showResult();
      }
    });

    function showResult() {
      const total = quizOrder.length;
      const percent = Math.round((score / total) * 100);
      let message = "";

      if (percent === 100) {
        message = "💮 すばらしい！ ぜんぶ 正解です。ごいりょく ばっちり！";
      } else if (percent >= 70) {
        message = "✨ よくできました！ あとすこしで まんてんです。";
      } else if (percent >= 50) {
        message = "◯ がんばりました。 もういちど チャレンジしてみよう。";
      } else {
        message = "📘 これから どんどん ごいを ふやしていこう。";
      }

      resultArea.innerHTML =
        `けっか：${score} / ${total} もん <br>${message}`;

      const restart = document.createElement("button");
      restart.type = "button";
      restart.textContent = "もういちど チャレンジ";
      restart.className = "restart-btn";
      restart.addEventListener("click", ()=>{ if(ONLINE.enabled && !ONLINE.isP1) return; restartQuiz(); if(ONLINE.enabled){ ONLINE.activePlayer=1; __pushState(__collectState({cardNums:null,cardSelected:null,treasureNum:null})); } });
resultArea.appendChild(restart);
    }

    
    async function boot(){
      // init online if possible
      await __initFirebase();
      if(ONLINE.enabled){
        __watchRemote();
        // P1 initializes if room is empty
        ONLINE.stateRef.once("value", (snap)=>{
          const v = snap.val();
          if(!v && ONLINE.isP1){
            // create initial state
            restartQuiz();
            ONLINE.activePlayer = 1;
            __pushState(__collectState({ cardNums:null, cardSelected:null, treasureNum:null }));
          }else if(v){
            __applyState(v);
          }else{
            // wait
          }
        });
      }else{
        // offline as before
        restartQuiz();
      }
    }


    function restartQuiz() {
      score = 0;
      scoreTextEl.textContent = "せいかい：0 もん";
      quizOrder = shuffle(questions);
      currentIndex = 0;
      qTotalEl.textContent = quizOrder.length.toString();
      updateProgress();
      renderQuestion();
      resetGimmick();
    }

    boot();
  </script>
</body>
</html>
